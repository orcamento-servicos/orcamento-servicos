<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Planejador de Orçamento — Registrar Serviço</title>

    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  </head>

  <body class="bg-[#111a22]" style='font-family: Inter, "Noto Sans", sans-serif'>
    <div class="relative flex min-h-screen w-full overflow-x-hidden">
      <!-- Sidebar igual ao do arquivo anterior -->
      <aside class="w-[310px] shrink-0 bg-[#1a2a38]/95 border-r border-white/10 shadow-[0_0_0_1px_rgba(255,255,255,0.04),0_10px_30px_rgba(0,0,0,0.35)] backdrop-blur supports-[backdrop-filter]:backdrop-blur sticky top-0 h-screen">
        <div class="p-5 flex flex-col h-full">
          <div class="flex flex-col items-center gap-3">
            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-24 w-24 ring-2 ring-white/10"
                 style='background-image:url("../Imagens/usuario.jpg");'></div>
            <div class="text-center">
              <p class="text-white text-lg font-bold leading-tight">Usuário exemplo</p>
              <p class="text-[#b9cee3] text-sm">Online</p>
            </div>
            <a href="TelaEditarPerfil.html"
               class="mt-1 inline-flex items-center justify-center h-9 px-4 rounded-lg bg-[#1773cf] text-white text-sm font-semibold hover:bg-[#1773cf]/90 transition">Editar Perfil</a>
          </div>

          <div class="mt-6">
            <h1 class="text-white text-sm font-medium">Planejador de Orçamento</h1>
            <p class="text-[#9fbbd4] text-xs">v1.0</p>
          </div>

          <nav class="mt-4 grid gap-1" id="sidebar">
            <!-- HOME -->
            <a href="TelaMenuPrincipal.html" class="menu-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition">
              <span class="text-white">
                <!-- ícone: casa -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 256 256" fill="currentColor" aria-hidden="true">
                  <path d="M218.83,103.3,141.17,33.33a16,16,0,0,0-22.34,0L37.17,103.3A16,16,0,0,0,32,114.64V208a16,16,0,0,0,16,16H96a8,8,0,0,0,8-8V160h48v56a8,8,0,0,0,8,8h48a16,16,0,0,0,16-16V114.64A16,16,0,0,0,218.83,103.3Z"/>
                </svg>
              </span>
              <span class="text-white text-sm font-medium">Home</span>
            </a>

            <a href="RegistrarEmpresa.html" class="menu-item group text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition">
              <span class="text-white">
                <!-- prédios -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M239.73,208H224V96a16,16,0,0,0-16-16H164a4,4,0,0,0-4,4V208H144V32.41a16.43,16.43,0,0,0-6.16-13,16,16,0,0,0-18.72-.69L39.12,72A16,16,0,0,0,32,85.34V208H16.27A8,8,0,0,0,8,215.47,8,8,0,0,0,16,224H240a8,8,0,0,0,8-8.53A8,8,0,0,0,239.73,208Z"/>
                </svg>
              </span>
              <span class="text-white text-sm font-medium">Registrar empresa</span>
            </a>

            <a href="RegistrarServico.html" class="menu-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition">
              <span class="text-white">
                <!-- arquivo -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34Z"/>
                </svg>
              </span>
              <span class="text-white text-sm font-medium">Registrar serviço</span>
            </a>

            <a href="AgendarServico.html" class="menu-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition">
              <span class="text-white">
                <!-- calendário -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Z"/>
                </svg>
              </span>
              <span class="text-white text-sm font-medium">Agendar serviço</span>
            </a>

            <a href="VerHistorico.html" class="menu-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition">
              <span class="text-white">
                <!-- relógio sólido (branco) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2zm1 5a1 1 0 0 0-2 0v5c0 .265.105.52.293.707l3 3a1 1 0 1 0 1.414-1.414L13 11.586V7z"/>
                </svg>
              </span>
              <span class="text-white text-sm font-medium">Ver histórico</span>
            </a>

            <a href="CriarOrcamento.html" class="menu-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition">
              <span class="text-white">
                <!-- plus -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"/>
                </svg>
              </span>
              <span class="text-white text-sm font-medium">Criar plano de orçamento</span>
            </a>
          </nav>

          <!-- Sair -->
          <div class="mt-auto pt-4">
            <a
              href="../TelaLogin.html"
              class="w-full inline-flex items-center justify-center h-10 px-4 rounded-lg bg-white/10 text-white font-semibold hover:bg-white/20 transition"
            >
              Sair
            </a>
          </div>
        </div>
      </aside>

      <!-- Conteúdo -->
      <main class="flex-1 max-w-[1100px] w-full mx-auto px-6 py-8">
        <h2 class="text-white text-2xl font-bold">Registrar Serviço</h2>
        <p class="text-[#93adc8] mt-1">Defina os serviços que você oferece.</p>

        <!-- FORMULÁRIO -->
        <div class="mt-6 grid max-w-xl gap-4">
          <input id="inp-nome" placeholder="Nome do serviço" class="form-input h-12 rounded-lg border-none bg-[#243647] text-white placeholder:text-[#93adc8]" />
          <textarea id="inp-desc" placeholder="Descrição" class="form-textarea min-h-28 rounded-lg border-none bg-[#243647] text-white placeholder:text-[#93adc8]"></textarea>
          <input id="inp-preco" type="number" step="0.01" min="0" placeholder="Preço" class="form-input h-12 rounded-lg border-none bg-[#243647] text-white placeholder:text-[#93adc8]" />
          <div class="flex items-center justify-between">
            <p id="msg" class="text-sm text-white/70"></p>
            <button id="btn-salvar" class="h-10 px-4 rounded-lg bg-[#1773cf] text-white font-bold">Salvar serviço</button>
          </div>
        </div>

        <!-- LISTA DE SERVIÇOS -->
        <div class="mt-10">
          <div class="flex items-end justify-between">
            <div>
              <h3 class="text-white text-xl font-semibold">Serviços registrados</h3>
              <p class="text-[#93adc8] text-sm mt-1">Gerencie seus serviços salvos.</p>
            </div>
            <input id="inp-busca" placeholder="Pesquisar..." class="form-input h-10 w-56 rounded-lg border-none bg-[#243647] text-white placeholder:text-[#93adc8]" />
          </div>

          <div class="mt-4 overflow-hidden rounded-xl border border-white/10">
            <table class="min-w-full divide-y divide-white/10">
              <thead class="bg-white/5">
                <tr class="text-[#b9cee3] text-sm">
                  <th class="px-4 py-3 text-left font-medium">Serviço</th>
                  <th class="px-4 py-3 text-left font-medium">Descrição</th>
                  <th class="px-4 py-3 text-right font-medium">Preço</th>
                  <th class="px-4 py-3 text-right font-medium">Ações</th>
                </tr>
              </thead>
              <tbody id="tbody-servicos" class="divide-y divide-white/5 text-white/90">
                <!-- itens gerados via JS -->
              </tbody>
            </table>
          </div>

          <!-- ESTADO VAZIO -->
          <div id="empty-state" class="mt-4 hidden">
            <p class="text-white/70">Nenhum serviço cadastrado ainda.</p>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Destaca item ativo conforme URL
      (function () {
        const path = location.pathname.split('/').pop() || '';
        document.querySelectorAll('#sidebar .menu-item').forEach(a => {
          const href = a.getAttribute('href') || '';
          if (href === path) a.classList.add("bg-[#243647]", "ring-1", "ring-white/10");
        });
      })();

      // ====== SERVIÇOS (localStorage) ======
      const KEY = 'servicosRegistrados:v1';

      const $nome = document.getElementById('inp-nome');
      const $desc = document.getElementById('inp-desc');
      const $preco = document.getElementById('inp-preco');
      const $btn = document.getElementById('btn-salvar');
      const $tbody = document.getElementById('tbody-servicos');
      const $busca = document.getElementById('inp-busca');
      const $msg = document.getElementById('msg');
      const $empty = document.getElementById('empty-state');

      function uid() { return Date.now().toString(36) + Math.random().toString(36).slice(2,7); }

      function load() {
        try { return JSON.parse(localStorage.getItem(KEY)) || []; }
        catch { return []; }
      }
      function save(list) {
        localStorage.setItem(KEY, JSON.stringify(list));
      }

      function moeda(v) {
        const n = Number(v || 0);
        return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(n);
      }

      function escapeHtml(s) {
        return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
      }

      function render(filter = '') {
        const data = load();
        const q = filter.trim().toLowerCase();
        const rows = data.filter(s =>
          !q ||
          s.nome.toLowerCase().includes(q) ||
          s.descricao.toLowerCase().includes(q) ||
          String(s.preco).toLowerCase().includes(q)
        );

        $tbody.innerHTML = '';
        rows.forEach(s => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="px-4 py-3 align-top">${escapeHtml(s.nome)}</td>
            <td class="px-4 py-3 align-top">${escapeHtml(s.descricao)}</td>
            <td class="px-4 py-3 text-right align-top">${moeda(s.preco)}</td>
            <td class="px-4 py-3 text-right align-top">
              <button data-del="${s.id}" class="inline-flex items-center gap-2 h-9 px-3 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm">
                <!-- lixeira -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" fill="currentColor"><path d="M216,56H168V40a24,24,0,0,0-24-24H112A24,24,0,0,0,88,40V56H40a8,8,0,0,0,0,16h8V208a24,24,0,0,0,24,24H184a24,24,0,0,0,24-24V72h8a8,8,0,0,0,0-16ZM104,40a8,8,0,0,1,8-8h32a8,8,0,0,1,8,8V56H104ZM192,208a8,8,0,0,1-8,8H72a8,8,0,0,1-8-8V72H192Z"/></svg>
                Excluir
              </button>
            </td>
          `;
          $tbody.appendChild(tr);
        });

        // estado vazio / sem resultados
        const hasData = data.length > 0;
        $empty.classList.toggle('hidden', hasData);
        if (rows.length === 0 && hasData) {
          $empty.classList.add('hidden');
          const tr = document.createElement('tr');
          tr.innerHTML = `<td class="px-4 py-6 text-center text-white/60" colspan="4">Nenhum resultado para “${escapeHtml(filter)}”.</td>`;
          $tbody.appendChild(tr);
        }
      }

      function showMsg(text, ok = true) {
        $msg.textContent = text;
        $msg.className = 'text-sm ' + (ok ? 'text-emerald-300' : 'text-red-300');
        setTimeout(() => { $msg.textContent = ''; $msg.className = 'text-sm text-white/70'; }, 2200);
      }

      // Salvar
      $btn.addEventListener('click', () => {
        const nome = $nome.value.trim();
        const descricao = $desc.value.trim();
        const preco = $preco.value.trim();

        if (!nome) { showMsg('Informe o nome do serviço.', false); $nome.focus(); return; }
        if (preco === '' || Number(preco) < 0) { showMsg('Informe um preço válido.', false); $preco.focus(); return; }

        const list = load();
        list.push({ id: uid(), nome, descricao, preco: Number(preco) });
        save(list);

        $nome.value = '';
        $desc.value = '';
        $preco.value = '';

        showMsg('Serviço salvo com sucesso!');
        render($busca.value);
      });

      // Excluir (delegação)
      document.getElementById('tbody-servicos').addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-del]');
        if (!btn) return;
        const id = btn.getAttribute('data-del');
        if (!confirm('Excluir este serviço?')) return;

        const list = load().filter(s => s.id !== id);
        save(list);
        render($busca.value);
      });

      // Busca
      $busca.addEventListener('input', (e) => render(e.target.value));

      // Inicializa
      render();
    </script>
  </body>
</html>
