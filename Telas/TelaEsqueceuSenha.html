<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900"
    />

    <title>OrçaTech — Recuperar senha</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  </head>
  <body>
    <div
      class="relative flex min-h-screen w-full flex-col bg-slate-50 overflow-x-hidden"
      style='font-family: Inter, "Noto Sans", sans-serif;'
    >
      <div class="layout-container flex h-full grow flex-col">
        <!-- Cabeçalho simples -->
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#e7edf3] px-6 md:px-10 py-3 h-16">
  <a href="TelaSobre.html" class="flex items-center gap-3 text-[#0d141b]">
    <div class="size-24 flex items-center justify-center">
      <img
        src="Imagens/OTLogoHeader.png"
        alt="Logo OrçaTech"
        class="w-24 h-24 object-contain"
      />
    </div>
    <h1 class="text-[#0d141b] text-lg font-bold leading-tight tracking-[-0.015em]">
      OrçaTech
    </h1>
  </a>

  <div class="flex flex-1 justify-end gap-6 md:gap-8">
    <nav class="flex items-center gap-6 md:gap-9">
      <a class="text-[#0d141b] text-sm font-medium leading-normal" href="TelaSobre.html" aria-current="page">Sobre</a>
      <a class="text-[#0d141b] text-sm font-medium leading-normal" href="TelaContato.html">Contato</a>
    </nav>
    <a
      href="TelaRegistrar.html"
      class="flex min-w-[120px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#1380ec] text-slate-50 text-sm font-bold leading-normal tracking-[0.015em]"
    >
      <span class="truncate">Registrar-se</span>
    </a>
    <a
      href="TelaLogin.html"
      class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#e7edf3] text-[#0d141b] text-sm font-bold leading-normal tracking-[0.015em]"
    >
      <span class="truncate">Entrar</span>
    </a>
  </div>
</header>

        <!-- Conteúdo -->
        <main class="flex flex-1 justify-center items-center px-4 md:px-10">
          <div class="w-full max-w-[480px]">
            <h2 class="text-[#0d141b] text-[28px] font-bold leading-tight text-center pb-3 pt-6">
              Recupere sua senha
            </h2>
            <p class="text-[#0d141b] text-base leading-normal text-center px-2 pb-4">
              Informe o e-mail associado à sua conta e enviaremos um link para redefinição de senha.
            </p>

            <form id="forgot-form" class="flex flex-col items-center gap-4" novalidate>
              <label for="email" class="w-full max-w-[420px]">
                <span class="sr-only">E-mail</span>
                <input
                  id="email"
                  name="email"
                  type="email"
                  autocomplete="email"
                  required
                  placeholder="Digite seu e-mail"
                  class="w-full rounded-lg border border-[#cfdbe7] bg-slate-50 h-14 p-[15px]
                         text-base text-[#0d141b] placeholder:text-[#4c739a]
                         focus:outline-0 focus:ring-0 focus:border-[#8fb6d8]"
                />
              </label>

              <button
                id="btn-forgot"
                type="submit"
                class="w-full max-w-[420px] h-11 rounded-lg bg-[#1380ec]
                       text-slate-50 text-sm font-bold tracking-[0.015em] flex items-center justify-center"
              >
                Enviar link de redefinição
              </button>

              <div id="forgot-feedback" class="text-sm mt-2 text-center"></div>

              <!-- link de retorno ao login, opcional -->
              <p class="text-[#4c739a] text-sm">
                Lembrou a senha?
                <a href="TelaLogin.html" class="underline">Voltar ao login</a>
              </p>
            </form>
          </div>
        </main>
      </div>
    </div>
    <script>
      // Intercepta o submit e chama a API REST para solicitar recuperação de senha
      (function(){
        const form = document.getElementById('forgot-form');
        const btn = document.getElementById('btn-forgot');
        const feedback = document.getElementById('forgot-feedback');

        function setFeedback(text, ok=true){
          feedback.textContent = text;
          feedback.style.color = ok ? '#0b7a3b' : '#b91c1c';
        }

        form.addEventListener('submit', async function(e){
          e.preventDefault();
          feedback.textContent = '';
          const email = (document.getElementById('email').value || '').trim();
          if(!email){
            setFeedback('Por favor informe um e-mail válido.', false);
            return;
          }

          btn.disabled = true;
          const originalText = btn.textContent;
          btn.textContent = 'Enviando...';

          try{
            const res = await fetch('/api/auth/forgot-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email })
            });

            const data = await res.json().catch(()=>({}));

            // Mensagem amigável (não expõe se o email existe)
            if(res.ok){
              let msg = 'Se o e-mail existir, enviaremos instruções para redefinição.';
              // Em ambiente de desenvolvimento o servidor pode retornar token_teste
              if(data && data.token_teste){
                msg += '\nToken (apenas dev): ' + data.token_teste;
              }
              setFeedback(msg, true);
            } else {
              const err = data && data.erro ? data.erro : `Erro: ${res.status}`;
              setFeedback(err, false);
            }

          } catch(err){
            setFeedback('Erro ao contatar o servidor. Verifique se o backend está rodando.', false);
          } finally{
            btn.disabled = false;
            btn.textContent = originalText;
          }
        });
      })();
    </script>
  </body>
</html>
